<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>AR Football Predictions</title>

    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .watermark {
            position: fixed;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: none;
        }

        .place-ar-btn {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
            padding: 28px 56px;
            background: linear-gradient(135deg, #A50044, #00529F);
            border: 4px solid white;
            border-radius: 24px;
            color: white;
            font-size: 28px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.7);
        }

        .place-ar-btn:active {
            transform: translate(-50%, -50%) scale(0.95);
        }

        .place-ar-btn.hidden {
            display: none;
        }

        .placement-hint {
            position: fixed;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 12px 24px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            pointer-events: none;
        }

        .placement-hint.hidden {
            display: none;
        }

        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .score-controls {
            display: flex;
            gap: 20px;
            width: 100%;
            max-width: 500px;
            justify-content: space-between;
        }

        .team-control {
            flex: 1;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .team-control.barcelona { border-top: 3px solid #A50044; }
        .team-control.realmadrid { border-top: 3px solid #00529F; }

        .team-name {
            color: white;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .score-display {
            color: white;
            font-size: 32px;
            font-weight: 700;
            min-width: 50px;
            text-align: center;
        }

        .score-buttons {
            display: flex;
            gap: 10px;
        }

        .score-btn {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .score-btn:active {
            transform: scale(0.95);
        }

        .barcelona .score-btn { background: rgba(165, 0, 68, 0.4); }
        .barcelona .score-btn:active { background: rgba(165, 0, 68, 0.6); }
        .realmadrid .score-btn { background: rgba(0, 82, 159, 0.4); }
        .realmadrid .score-btn:active { background: rgba(0, 82, 159, 0.6); }

        .save-btn {
            width: 100%;
            max-width: 300px;
            padding: 16px 32px;
            background: linear-gradient(135deg, rgba(165, 0, 68, 0.8), rgba(0, 82, 159, 0.8));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
        }

        .save-btn:active {
            transform: scale(0.98);
        }

        .a-enter-vr-button {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="watermark">âœ¨ by Augmento</div>

    <button class="place-ar-btn" id="place-ar-btn" onclick="placeARPrediction()">
        ðŸŽ¯ TAP TO PLACE
    </button>

    <div class="placement-hint" id="placement-hint">
        Point camera where you want to place the prediction
    </div>

    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true;">

        <a-camera id="camera" position="0 0 0">
            <!-- Placement reticle - always in center of screen -->
            <a-ring
                id="reticle"
                position="0 0 -0.5"
                radius-inner="0.01"
                radius-outer="0.015"
                color="#00FF00"
                opacity="0.8"
                material="shader: flat">
            </a-ring>
        </a-camera>

        <!-- AR Content in WORLD SPACE - will be positioned by raycast -->
        <a-entity id="ar-content" visible="false">

            <!-- Platform base -->
            <a-circle
                position="0 0.01 0"
                radius="1.2"
                rotation="-90 0 0"
                color="#1a1a1a"
                opacity="0.8"
                material="shader: flat; side: double">
            </a-circle>

            <!-- Barcelona Logo -->
            <a-entity position="-0.5 0.3 0.3">
                <a-cylinder position="0 0 0" radius="0.15" height="0.05" color="#A50044"></a-cylinder>
                <a-cylinder position="0 0.1 0" radius="0.02" height="0.15" color="#A50044"></a-cylinder>
                <a-box position="0 0.18 0" width="0.3" height="0.3" depth="0.05" color="#A50044"></a-box>
                <a-image src="assets/barcelona.png" width="0.28" height="0.28" position="0 0.18 0.03" transparent="true"></a-image>
                <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-entity>

            <!-- Real Madrid Logo -->
            <a-entity position="0.5 0.3 0.3">
                <a-cylinder position="0 0 0" radius="0.15" height="0.05" color="#00529F"></a-cylinder>
                <a-cylinder position="0 0.1 0" radius="0.02" height="0.15" color="#00529F"></a-cylinder>
                <a-box position="0 0.18 0" width="0.3" height="0.3" depth="0.05" color="#00529F"></a-box>
                <a-image src="assets/realmadrid.png" width="0.28" height="0.28" position="0 0.18 0.03" transparent="true"></a-image>
                <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-entity>

            <!-- VS Text -->
            <a-text
                value="VS"
                position="0 0.65 0.3"
                align="center"
                color="#FFFFFF"
                width="2"
                material="shader: flat">
            </a-text>

            <!-- Barcelona Score -->
            <a-entity id="barcelona-score-3d" position="-0.5 0.25 -0.1"></a-entity>

            <!-- Dash -->
            <a-box position="0 0.3 -0.1" width="0.1" height="0.03" depth="0.03" color="#FFFFFF" material="shader: flat; side: double"></a-box>

            <!-- Real Madrid Score -->
            <a-entity id="realmadrid-score-3d" position="0.5 0.25 -0.1"></a-entity>

        </a-entity>

        <a-light type="ambient" intensity="1.5"></a-light>
        <a-light type="directional" intensity="1" position="1 2 1"></a-light>

    </a-scene>

    <div class="controls">
        <div class="score-controls">
            <div class="team-control barcelona">
                <div class="team-name">Barcelona</div>
                <div class="score-display" id="barcelona-score-ui">4</div>
                <div class="score-buttons">
                    <button class="score-btn" onclick="adjustScore('barcelona', -1)">âˆ’</button>
                    <button class="score-btn" onclick="adjustScore('barcelona', 1)">+</button>
                </div>
            </div>

            <div class="team-control realmadrid">
                <div class="team-name">Real Madrid</div>
                <div class="score-display" id="realmadrid-score-ui">2</div>
                <div class="score-buttons">
                    <button class="score-btn" onclick="adjustScore('realmadrid', -1)">âˆ’</button>
                    <button class="score-btn" onclick="adjustScore('realmadrid', 1)">+</button>
                </div>
            </div>
        </div>

        <button class="save-btn" onclick="savePrediction()">ðŸ“¸ Save Prediction</button>
    </div>

    <script>
        let scores = { barcelona: 4, realmadrid: 2 };
        let arPlaced = false;

        // Seven-segment display patterns
        const SEGMENTS = {
            0: ['top', 'topRight', 'bottomRight', 'bottom', 'bottomLeft', 'topLeft'],
            1: ['topRight', 'bottomRight'],
            2: ['top', 'topRight', 'middle', 'bottomLeft', 'bottom'],
            3: ['top', 'topRight', 'middle', 'bottomRight', 'bottom'],
            4: ['topLeft', 'middle', 'topRight', 'bottomRight'],
            5: ['top', 'topLeft', 'middle', 'bottomRight', 'bottom'],
            6: ['top', 'topLeft', 'middle', 'bottomLeft', 'bottom', 'bottomRight'],
            7: ['top', 'topRight', 'bottomRight'],
            8: ['top', 'topRight', 'bottomRight', 'bottom', 'bottomLeft', 'topLeft', 'middle'],
            9: ['top', 'topRight', 'middle', 'topLeft', 'bottomRight', 'bottom']
        };

        // Segment configuration - WHITE color for production
        const SEGMENT_CONFIG = {
            top:          { x: 0,     y: 0.15,  z: 0, w: 0.12, h: 0.03, d: 0.03, rx: 0, ry: 0, rz: 0 },
            topRight:     { x: 0.06,  y: 0.08,  z: 0, w: 0.09, h: 0.03, d: 0.03, rx: 0, ry: 0, rz: 90 },
            bottomRight:  { x: 0.06,  y: -0.08, z: 0, w: 0.09, h: 0.03, d: 0.03, rx: 0, ry: 0, rz: 90 },
            bottom:       { x: 0,     y: -0.15, z: 0, w: 0.12, h: 0.03, d: 0.03, rx: 0, ry: 0, rz: 0 },
            bottomLeft:   { x: -0.06, y: -0.08, z: 0, w: 0.09, h: 0.03, d: 0.03, rx: 0, ry: 0, rz: 90 },
            topLeft:      { x: -0.06, y: 0.08,  z: 0, w: 0.09, h: 0.03, d: 0.03, rx: 0, ry: 0, rz: 90 },
            middle:       { x: 0,     y: 0,     z: 0, w: 0.12, h: 0.03, d: 0.03, rx: 0, ry: 0, rz: 0 }
        };

        function createNumber(num, container, color) {
            console.log(`Creating 3D number ${num} in ${color}`);

            // Clear existing
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }

            const segments = SEGMENTS[num];

            segments.forEach((segName) => {
                const cfg = SEGMENT_CONFIG[segName];

                const box = document.createElement('a-box');
                box.setAttribute('position', `${cfg.x} ${cfg.y} ${cfg.z}`);
                box.setAttribute('rotation', `${cfg.rx} ${cfg.ry} ${cfg.rz}`);
                box.setAttribute('width', cfg.w);
                box.setAttribute('height', cfg.h);
                box.setAttribute('depth', cfg.d);
                box.setAttribute('color', color);
                box.setAttribute('material', 'shader: flat; side: double');

                container.appendChild(box);
            });

            console.log(`âœ“ Number ${num} complete: ${segments.length} segments`);
        }

        function placeARPrediction() {
            console.log('ðŸŽ¯ Placing AR prediction in world space...');

            const camera = document.getElementById('camera');
            const arContent = document.getElementById('ar-content');
            const barcelonaContainer = document.getElementById('barcelona-score-3d');
            const realmadridContainer = document.getElementById('realmadrid-score-3d');
            const placeBtn = document.getElementById('place-ar-btn');
            const reticle = document.getElementById('reticle');
            const hint = document.getElementById('placement-hint');

            // Get camera position and rotation
            const cameraPos = camera.object3D.position;
            const cameraRot = camera.object3D.rotation;

            // Calculate placement position 2 meters in front of camera
            const distance = 2;
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(camera.object3D.quaternion);

            const placePos = new THREE.Vector3(
                cameraPos.x + direction.x * distance,
                cameraPos.y + direction.y * distance - 0.5, // Slightly below eye level
                cameraPos.z + direction.z * distance
            );

            // Position AR content in world space
            arContent.object3D.position.copy(placePos);

            // Make content face the camera
            arContent.object3D.lookAt(cameraPos);
            arContent.object3D.rotation.x = 0; // Keep upright

            // Show AR content
            arContent.setAttribute('visible', 'true');

            // Create 3D numbers
            createNumber(scores.barcelona, barcelonaContainer, '#FFFFFF');
            createNumber(scores.realmadrid, realmadridContainer, '#FFFFFF');

            // Hide UI elements
            placeBtn.classList.add('hidden');
            hint.classList.add('hidden');
            reticle.setAttribute('visible', 'false');

            arPlaced = true;

            console.log('ðŸŽ‰ AR prediction placed in real world at:', placePos);
        }

        function adjustScore(team, delta) {
            scores[team] = Math.max(0, Math.min(9, scores[team] + delta));
            document.getElementById(`${team}-score-ui`).textContent = scores[team];

            if (arPlaced) {
                const container = document.getElementById(`${team}-score-3d`);
                createNumber(scores[team], container, '#FFFFFF');
            }
        }

        function savePrediction() {
            const controls = document.querySelector('.controls');
            const placeBtn = document.getElementById('place-ar-btn');

            controls.style.display = 'none';
            if (!placeBtn.classList.contains('hidden')) placeBtn.style.display = 'none';

            setTimeout(() => {
                const scene = document.querySelector('a-scene');
                const canvas = scene.canvas || scene.querySelector('canvas');

                if (canvas) {
                    canvas.toBlob((blob) => {
                        if (blob) {
                            const url = URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = `prediction-${scores.barcelona}-${scores.realmadrid}.png`;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            URL.revokeObjectURL(url);
                        }
                        controls.style.display = 'flex';
                    }, 'image/png');
                } else {
                    controls.style.display = 'flex';
                }
            }, 200);
        }

        console.log('ðŸš€ AR Football Predictions ready');
        console.log('Tap PLACE NOW to start');
    </script>
</body>
</html>
